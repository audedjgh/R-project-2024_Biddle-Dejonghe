---
title: "Files loading and description"
author: "Aude Dejonghe and Carlos Biddle"
format: 
  html: default
  pdf: default
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r}
#| message: false
library(here)
here::i_am("R-project-2024_Biddle-Dejonghe.Rproj")
```

# INTRODUCTION

This document will show:

-   The sources used for the project with their description
-   The description of the work of joining and cleaning the data
-   The explanation of our research question

To begin with, click [here](https://github.com/audedjgh/R-project-2024_Biddle-Dejonghe) to access our github project.

```{r}
#| message: false
#| warning: false
# Load required libraries
library(readr)
library(readxl)
library(dplyr)
library(stringr)

# Define NA values
na_values <- c("NA", "NO", "IE", "NO,NA", "NO, NA", "NO,NE", "", "N/A")

# Creating the list of EU countries to filter data
EU_countries <- c("Austria", "Belgium", "Bulgaria", "Croatia", "Cyprus", "Czechia", "Denmark", "Estonia", "Finland", "France", "Germany", "Greece", "Hungary", "Ireland", "Italy", "Latvia", "Lithuania", "Luxembourg", "Malta", "Netherlands", "Poland", "Portugal", "Romania", "Slovakia", "Slovenia", "Spain", "Sweden"
)

# Clean numeric function
clean_numeric <- function(x) {
  if(is.character(x)) {
    x <- gsub(",", ".", x)
    x <- gsub(" ", "", x)
    suppressWarnings(as.numeric(x))
  } else {
    x
  }
}

# Simplified clean_dataset function
clean_dataset <- function(df) {
  id_columns <- c("LOCATION", "INDICATOR", "Indicator", "Inequality", "Unit Code", "Unit", "Country", "country", "COUNTRY", "Year", "year", "YEAR", "Country Name", "Country Code", "Indicator Name", "Indicator Code", "Country name", "Description as in CRF", "Sector_name", "Unit", "Emissions")
  
  df |>
    mutate(across(
      where(is.character) & !any_of(id_columns),
      ~clean_numeric(.)
    ))
}

# Import and clean datasets
suppressMessages({
  Better_Life_Index_2022 <- read_delim(
    file = "data/Clean 2022 Better Life Index.csv", 
    delim = ",", 
    escape_double = FALSE, 
    trim_ws = TRUE,
    na = na_values,
    show_col_types = FALSE
  ) %>% clean_dataset()
  
  Better_Life_Index_2013 <- read_delim(
    file = "data/Better Life Index 2013.csv", 
    delim = ";", 
    escape_double = FALSE, 
    trim_ws = TRUE,
    na = na_values,
    show_col_types = FALSE
  ) %>% clean_dataset()
  
  Education <- read_excel(
    path = "data/Education.xls", 
    sheet = "Data",
    na = na_values
  ) %>% clean_dataset()
  
  GDP <- read_excel(
    path = "data/GDP (current US$).xls", 
    sheet = "Data",
    na = na_values
  ) %>% clean_dataset()
  
  Gas_emissions <- read_excel(
    path = "data/GovReg_GHG proxy_2023.xlsx", 
    sheet = "EEA proxy dataset (plus)",
    na = na_values
  ) %>% clean_dataset()
  
  Health <- read_excel(
    path = "data/Health.xls", 
    na = na_values
  ) %>% clean_dataset()
  
  Share_of_renewable_sources <- read_excel(
    path = "data/Share of energy from renewable sources.xlsx", 
    sheet = "SUMMARY",
    skip = 1,
    na = na_values
  ) %>% clean_dataset()
})


# Filter datasets on information wanted

Better_Life_Index_2022 <- Better_Life_Index_2022 |>
  select(Country, Indicator, Unit, Value) |>
  filter(Country %in% EU_countries)

Better_Life_Index_2013 <- Better_Life_Index_2013 |>
  select(Country, Indicator, Inequality, Value) |>
  filter(Country %in% EU_countries, Inequality == "Total")

Education <- Education |>
  select(`Country Name`, `Indicator Name`, matches("^20\\d{2}$")) |>
  filter(`Country Name` %in% EU_countries)

Gas_emissions <- Gas_emissions |>
  select(`Country name`, `Description as in CRF`, Sector_name, Unit, Emissions) |>
  filter(`Country name` %in% EU_countries, str_detect(`Sector_name`, "Total"))

GDP <- GDP |>
  select(`Country Name`, `Indicator Name`, matches("^20\\d{2}$")) |>
  filter(`Country Name` %in% EU_countries)

Health <- Health |>
  select(`Country Name`, `Indicator Name`, matches("^20\\d{2}$")) |>
  filter(`Country Name` %in% EU_countries)

Overall_share_of_renewable_sources <- Share_of_renewable_sources |>
  slice(1:38) |>
  select(2:21) |>
  filter(`Country Name` %in% EU_countries)

colnames(Overall_share_of_renewable_sources)[-1] <- substr(colnames(Overall_share_of_renewable_sources)[-1], 1, 4)
```

## Link to sources

-   [Better Life Index 2022](https://www.oecd-ilibrary.org/social-issues-migration-health/data/oecd-social-and-welfare-statistics/better-life-index-edition-2022_a4815531-en)
-   [Education](https://data.worldbank.org/topic/education)
-   [GDP](https://data.worldbank.org/indicator/NY.GDP.MKTP.CD?locations=EU)
-   [Gas emissions](https://www.eea.europa.eu/en/datahub/datahubitem-view/f6e68f73-b494-4f8c-8c73-8a153a53f64a)
-   [Health](https://data.worldbank.org/topic/health)
-   [Share of renewable energy](https://ec.europa.eu/eurostat/web/energy/database/additional-data#Short%20assessment%20of%20renewable%20energy%20sources%20(SHARES))

# DESCRIPTION OF THE DATASETS

## Better Life Index

Our first dataset includes data for the OECD's Better Life Index in 2022. The OECD Better Life Index Edition 2022 provides data on well-being across OECD member countries and some partners (we'll concentrate on 27 EU countries), covering topics such as housing, income, jobs, education, community, health, environment, safety, life satisfaction, and work-life balance. The data is compiled from national statistical offices, OECD surveys, and other relevant tools, ensuring global comparability of quality-of-life metrics. This dataset is updated annually, though some components, like subjective well-being or community engagement metrics, depend on periodic survey collections. It enables cross-country comparisons and offers insights into policy impacts on citizens' lives. Since our research is going to compare data over years, this is an example of the better life index, but we'll download and summarise other files like this to have an overview time wise. The data is available since 2013, each year.

|                        |                                  |
|------------------------|----------------------------------|
| Number of observations | `r NROW(Better_Life_Index_2022)` |
| Number of variables    | `r NCOL(Better_Life_Index_2022)` |

## Education

The education dataset from the World Bank database has 165 indicators to choose from, including enrollment rates, literacy levels, teacher-pupil ratios, government spending on education, and learning outcomes. This data is drawn from government ministries, international organizations, and World Bank studies. It is updated annually, though some indicators, like results from international assessments (e.g., PISA, TIMSS), are released every few years. The dataset supports monitoring of global education progress, disparities, and achievements, particularly in relation to Sustainable Development Goal 4 on quality education. We'll consider all 27 EU countries - into 4 income groups (high income, upper middle income, lower middle income, low income).

|                        |                     |
|------------------------|---------------------|
| Number of observations | `r NROW(Education)` |
| Number of variables    | `r NCOL(Education)` |

## GDP

This dataset provides annual Gross Domestic Product (GDP) figures in current US dollars for countries worldwide, with detailed data on the European Union. The World Bank collects this information from national accounts, statistical agencies, and IMF sources, ensuring consistency across countries. Updates occur annually, with quarterly estimates provided for certain regions. This dataset is vital for evaluating economic performance, identifying growth trends, and comparing the GDP of different regions and countries over time. It's calculated with official exchange rates, without adjusting for inflation or purchasing power parity, and represents the monetary value of all finished goods and services produced in an economy.

|                        |               |
|------------------------|---------------|
| Number of observations | `r NROW(GDP)` |
| Number of variables    | `r NCOL(GDP)` |

## Gas emissions

The European Environment Agency (EEA) Renewable Energy Data tracks the use and contribution of renewable energy in Europe, including electricity, heating, and transport sectors. It estimates the share of renewables in gross final energy consumption and monitors progress toward EU renewable energy targets. This data is collected from national energy statistics and harmonized through Eurostat and other EU reporting mechanisms. It is updated annually, following the SHARES (Short Assessment of Renewable Energy Sources) methodology, ensuring alignment with EU directives. The dataset is a key resource for assessing the EU’s progress toward climate and energy goals. It offers estimates for total emissions along with industry-specific contributions, for instance, those relating to energy, transport, and agriculture. The data is crucial for policymakers, researchers and environmentalists to study progress in emission reductions. Since our research is going to compare data over years, we plan to do the same thing as for "Better Life Index" dataset and join several years data together.

|                        |                         |
|------------------------|-------------------------|
| Number of observations | `r NROW(Gas_emissions)` |
| Number of variables    | `r NCOL(Gas_emissions)` |

## Health

Then, we have the health dataset, supplied by the World Bank.It includes indicators such as life expectancy, healthcare expenditure, immunization rates, and disease prevalence. The data is sourced from national health agencies, WHO publications, and World Bank studies. It is updated annually, with some metrics dependent on periodic demographic and health surveys (e.g., DHS) or WHO global health reports. This dataset enables the analysis of health outcomes, resource allocation, and comparisons of health system performance across countries and regions.

|                        |                  |
|------------------------|------------------|
| Number of observations | `r NROW(Health)` |
| Number of variables    | `r NCOL(Health)` |

## Share of renewable energy

Finally, the Eurostat Renewable Energy Database (SHARES) focuses on tracking renewable energy trends in the EU, measuring energy production, installed capacity, and the proportion of renewables in the energy mix. It also evaluates progress toward national and EU-wide renewable energy goals. Data is collected from national statistical offices and harmonized through EU legislative frameworks. Updates are conducted annually, using the SHARES methodology, which ensures consistent reporting and alignment with EU policies. This dataset provides detailed insights for policymakers and stakeholders engaged in the EU Green Deal and sustainable energy initiatives. It provides in-depth statistics on the fraction of renewable energy sources to gross final energy consumption in EU member states. The data covers electricity, heating and cooling, and transport. Key points include national shares of renewable energy, normalised values for hydropower and wind power, and compliance with sustainability criteria.

|                        |                                      |
|------------------------|--------------------------------------|
| Number of observations | `r NROW(Share_of_renewable_sources)` |
| Number of variables    | `r NCOL(Share_of_renewable_sources)` |

# MOST IMPORTANT VARIABLES

## Better Life Index

With the Better Life Index, the value associated to each country is calculated as a weighted score of 11 topics. The dataset includes variables such as housing conditions, measured by the number of rooms per person and housing affordability, and income, represented by disposable household income and wealth per capita. It also tracks job-related metrics, like employment rates and job security, alongside education levels, community engagement, self-reported health status, air quality indicators for the environment, and crime rates for safety. Additional variables include life satisfaction and work-life balance, focusing on time spent between work and leisure.

## Education

As for the education dataset, we can focus on the variable "Educational attainment, at least completed upper secondary, population 25+, total (%) (cumulative)", as it measures the proportion of the adult population with at least a high school diploma, which is a crucial indicator of human capital development, and helps understand a country's workforce competitiveness. The dataset encompasses variables like gross and net enrollment rates at different education levels, literacy rates by age group, and teacher-pupil ratios. It also includes government education expenditure as a percentage of GDP and learning outcomes, represented by scores from international assessments such as PISA and TIMSS.

## GDP

The dataset provides annual GDP figures in current USD for countries worldwide, along with growth rates that reflect year-on-year economic performance. It also breaks down sectoral contributions to GDP, such as agriculture, industry, and services, and facilitates regional comparisons of economic output across countries.

## Gas emissions

Key variables include the share of renewable energy in gross final energy consumption, the contribution of specific energy sources such as wind, solar, hydro, biomass, and geothermal, and the sectoral usage of renewables in electricity, heating, and transport. The dataset also monitors progress toward EU renewable energy targets.

## Health

The dataset includes variables like life expectancy at birth, healthcare expenditure (total and per capita), and immunization rates for diseases like measles and polio. It tracks the prevalence of diseases, including communicable and non-communicable conditions, as well as health resources, such as the number of doctors, nurses, and hospital beds per capita.

## Share of renewable energy

This dataset tracks annual renewable energy production in GWh or TWh, the installed capacity of renewable energy plants in MW, and the proportion of renewables in the total energy mix. It also includes progress indicators to assess alignment with national and EU-wide renewable energy targets.

# RESEARCH QUESTION DEVELOPMENT

## Introduction

The transition to renewable energy is a critical goal for European countries in addressing climate change, energy security, and sustainable development. While technological advancements and policy frameworks play pivotal roles in shaping this transition, socioeconomic factors are equally influential in driving investments in renewable energy. This project has the goal to explore the connections between certain socioeconomic dimensions—such as GDP, health, education, welfare, and pollution—and the level of renewable energy investments across Europe. Additionally, it'll highlight areas for further exploration to understand and visualize these dynamics effectively.

## The Role of Socioeconomic Factors

Economic Development (GDP and Income Levels): Economic prosperity, often measured by GDP per capita, is one of the primary determinants of renewable energy investments. Countries with higher GDPs, such as Germany, France, and the Netherlands, tend to allocate more resources to infrastructure development and energy transition projects. Wealthier nations often have greater access to capital markets, which facilitates investments in expensive renewable technologies, such as offshore wind farms or advanced solar panels. In contrast, economically weaker nations may struggle to meet initial investment costs, despite benefiting from EU funding schemes.

Health and Pollution Awareness: Pollution levels and associated health impacts often galvanize public and political support for cleaner energy sources. Countries experiencing severe air quality challenges, like Poland or Hungary (due to reliance on coal), may face greater pressure from citizens and advocacy groups to invest in renewables. The health burden from pollution, measured through indicators such as respiratory disease prevalence or life expectancy, can serve as a compelling argument for redirecting investments toward cleaner energy options.

Education and Public Awareness: Education plays a critical role in shaping attitudes toward environmental sustainability. Societies with higher literacy rates and widespread access to quality education are more likely to support renewable energy policies and initiatives. Public understanding of climate science, energy efficiency, and long-term benefits of renewable technologies can influence government and private-sector investment priorities. For instance, Scandinavian countries, known for their strong education systems, consistently lead in renewable energy adoption.

Social Welfare and Policy Support: Social welfare systems indirectly influence renewable energy investments. Countries with robust welfare systems, like Denmark or Sweden, can more easily absorb the social costs of transitioning from fossil fuels to renewables, such as retraining workers or subsidizing green energy access for low-income households. Additionally, higher levels of social trust and cooperative governance in these nations contribute to smoother implementation of renewable energy projects.

## Potential Areas for Further Exploration

Data Visualization: To understand these relationships better, a cross-country comparative analysis can be conducted using visual tools like scatterplots, heatmaps, or GIS maps. For instance, correlating GDP per capita with renewable energy capacity installed could reveal interesting patterns across Europe.

Temporal Trends: Analyzing how investments in renewables have evolved over the past decades relative to socioeconomic changes could uncover critical insights about long-term drivers.

Barriers in Low-GDP Nations: Examining the unique challenges faced by economically weaker European countries in scaling renewable investments, despite EU-wide climate goals, could highlight gaps in support mechanisms.





# DATA ANALYSIS

In this document, we'll try to see and assess any links between certain socioeconomic factors of EU countries and their willingness to invest in renewable energy.

We can start by stating our intuition hypothesis : Countries with higher life satisfaction, better education, and lower air pollution levels are more likely to invest in renewable energy.


## View on life disparities between EU countries

Our analysis begins with a chart representing the average score of life satisfaction each country obtained in 2013 and in 2022.

```{r}
library(ggplot2)
library(dplyr)

Better_Life_Index_2013 |>
  filter(Indicator == "Life satisfaction") |>
  ggplot(aes(x = reorder(Country, Value), y = Value)) + 
  geom_bar(stat = "identity") +  
  coord_flip() + 
  labs(title = "Life Satisfaction by Country (2013)", 
       x = "Country", 
       y = "Life Satisfaction Value") +
  theme_minimal()

Better_Life_Index_2022 |>
  filter(Indicator == "Life satisfaction") |>
  ggplot(aes(x = reorder(Country, Value), y = Value)) + 
  geom_bar(stat = "identity") +  
  coord_flip() + 
  labs(title = "Life Satisfaction by Country (2022)", 
       x = "Country", 
       y = "Life Satisfaction Value") +
  theme_minimal()
  
```
The overall "Life Satisfaction" values appear to have slightly increased for most countries from 2013 to 2022, with Finland emerging as a standout performer by 2022. While the relative rankings for some countries like Greece and Hungary remain low, the overall progress indicates that life satisfaction is improving globally, albeit at different rates across regions.

We can start by stating our hypothesis : Countries with higher life satisfaction, better education, and lower air pollution levels are more likely to invest in renewable energy.

Let's then find out if the top countries in Life satisfaction are the same ones that are top ranks when seeing their share or renewable energy.

```{r}
library(tidyr)

# First, let's prepare the data 
# We'll convert it from wide format (years as columns) to long format
overall_renewable_share_long <- Overall_share_of_renewable_sources %>%
  pivot_longer(
    cols = -`Country Name`,  
    names_to = "Year",
    values_to = "Share"
  )

#Create comparable base in 2022 to see ranking
overall_renewable_share_long |>
  filter(Year == 2022) |>
  ggplot(aes(x = reorder(`Country Name`, Share), y = Share)) + 
  geom_bar(stat = "identity") +  
  coord_flip() + 
  labs(title = "Share of renewable energy by EU Country (2022)", 
       x = "Country", 
       y = "Share of renewable energy (in%)") +
  theme_minimal()
```

```{r}
# Create the line plot
ggplot(overall_renewable_share_long, aes(x = Year, y = Share, color = `Country Name`, group = `Country Name`)) +
  geom_line(linewidth = 0.5) +
  geom_point(size = 1) +
  theme_minimal() +
  labs(
    title = "Share of Renewable Energy Sources Over Time in EU countries",
    x = "Year",
    y = "Share of Renewable Energy (%)",
    color = "Country"
  ) +
  theme(
    legend.position = "right",
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold")
  )

```
Thanks to these graphs, we can visualize the evolution of EU countries through time regarding their share of renewable energy among total energy from 2004 and 2022. In other words, it shows how much shares of renewable energy their investment in this matter allowed them to have. 
We can see that the shares are globally increasing for every EU country studied.
But, the main difference with the life satisfaction critera studied before is that the top country is Sweden, with a large difference if we compare it to the other countries. 
Then we find Finland and Denmark in top 5, which is coherent with the Life satisfaction criteria.
Some other countries like France Poland and Hungary, are more or less coherent with analysis made previously.

However correlation is not proven and a bit blurry, so we're going to deepen the analysis, enlarging the criterions to more measurable ones, as "Life satisfaction" is hard to measure and not 100% reliable data.



## To erase at the end : ideas for the analysis 
Suggested Graphs:

    Histograms or Boxplots:
        Show the distribution of key variables (e.g., "share of renewable energy," "GDP," "employment rate").
    Correlation Heatmap:
        Use a heatmap to visualize the correlations between variables like GDP, life satisfaction, air pollution, and renewable energy investments.

3. Analysis Over Time
Tasks:

    Trend Analysis:
        Analyze how renewable energy investments have changed over time.
        Compare this to trends in socioeconomic variables like GDP, air pollution, and education.

    Graphs for Trends:
        Line Charts:
            Show the evolution of renewable energy investments over time for different countries.
            Overlay trends of key socioeconomic variables (e.g., life expectancy, GDP).
        Stacked Area Charts:
            Display the share of renewable energy production by country over time.

4. Statistical Analysis
A. Correlation Analysis

    Use correlation coefficients to determine the strength of relationships between variables (e.g., between renewable energy share and air pollution, GDP).

Code Example in R:

cor_matrix <- cor(data[, c("Renewable_Energy_Share", "GDP", "Life_Expectancy", "Air_Pollution")], use = "complete.obs")
heatmap(cor_matrix, main = "Correlation Heatmap", col = colorRampPalette(c("blue", "white", "red"))(50))

B. Linear Regression

    Perform a multiple linear regression to quantify the influence of socioeconomic factors on renewable energy investments.

Model:
Renewable Energy Share=β0+β1(GDP)+β2(Air Pollution)+β3(Education)+ϵ
Renewable Energy Share=β0​+β1​(GDP)+β2​(Air Pollution)+β3​(Education)+ϵ
Code Example in R:

model <- lm(Renewable_Energy_Share ~ GDP + Air_Pollution + Education, data = data)
summary(model)

    Interpret the regression coefficients:
        Positive coefficients mean the variable drives renewable energy investment.
        Negative coefficients mean it hinders renewable energy investment.

C. Chi-Square Test for Independence

    Use a Chi-Square test to explore categorical relationships. For example, you could test if the share of renewable energy is associated with categorical factors like "employment rate" or "education level" groups.

Code Example:

chisq_test <- chisq.test(table(data$Renewable_Energy_Category, data$Education_Level))
print(chisq_test)

    Check if the p-value < 0.05 to confirm significant relationships.

5. Comparing Across Countries
Tasks:

    Clustering:
        Use clustering methods (e.g., k-means) to group countries based on their socioeconomic profiles and renewable energy investments.

Code Example:

library(cluster)
cluster_data <- data[, c("GDP", "Air_Pollution", "Renewable_Energy_Share")]
kmeans_result <- kmeans(cluster_data, centers = 3)
fviz_cluster(kmeans_result, data = cluster_data)

    Barplots:
        Compare countries in terms of key variables using grouped bar charts.

Suggested Graphs:

    Barplots:
        Rank countries by their share of renewable energy or investment levels.
    Scatter Plots:
        Plot GDP vs. renewable energy share with country labels.

6. Conclusion

    Summarize findings:
        Which socioeconomic factors have the strongest influence on renewable energy investments?
        How do these factors vary by country and over time?
    Discuss policy implications:
        What policies should governments adopt to drive renewable energy investment?

Recap of Necessary Graphs:

    Histograms/Boxplots: Distribution of key variables.
    Correlation Heatmap: Relationship between variables.
    Line Charts: Trends over time for renewable energy and key factors.
    Barplots: Comparison between countries.
    Scatter Plots: Relationship between two variables.
    Cluster Diagram: Group countries by profiles.

Summary of Calculations:

    Summary Statistics: Mean, median, etc., for variables.
    Correlation Analysis: Quantify relationships.
    Linear Regression: Identify drivers of renewable energy investments.
    Chi-Square Test: Test independence between categorical variables.
    Clustering: Group countries by socioeconomic indicators.




# CONCLUSION

...
